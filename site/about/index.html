<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–û–ø–ª–∞—Ç–∞ ‚Äî reklama.kyrgyzstann1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
    <div class="max-w-2xl w-full bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-4">–û–ø–ª–∞—Ç–∞</h1>
        <p class="text-gray-700 mb-6">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã ‚Äî –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫/–∫–≤–∏—Ç–∞–Ω—Ü–∏—é —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ.</p>

        <div class="bg-gray-50 border border-gray-200 rounded p-4 mb-6">
            <h2 class="font-semibold mb-2">–†–µ–∫–≤–∏–∑–∏—Ç—ã</h2>
            <ul class="text-gray-800 space-y-1">
                <li><strong>–ù–æ–º–µ—Ä –¥–ª—è –æ–ø–ª–∞—Ç—ã:</strong> +996 700 115 233</li>
                <li><strong>–ë–∞–Ω–∫:</strong> Mbank / o! bank</li>
                <li><strong>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</strong> Aida.M</li>
            </ul>
        </div>

    <div id="orderSummary" class="mb-4 p-4 bg-yellow-50 border border-yellow-100 rounded hidden"></div>
    <div id="orderTotals" class="mb-4 p-4 bg-green-50 border border-green-100 rounded hidden text-gray-800">
        <div id="tariffPrice" class="text-lg font-bold">–ò—Ç–æ–≥–æ —Å –≤–∞—Å: ‚Äî —Å–æ–º</div>
    </div>
    <form id="paymentForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">–í–∞—à–µ –∏–º—è</label>
                <input id="payerName" type="text" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" class="mt-1 block w-full border rounded px-3 py-2" required>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">–°—É–º–º–∞ (—Å–æ–º)</label>
                <input id="amount" type="number" min="0" step="1" placeholder="100" class="mt-1 block w-full border rounded px-3 py-2 bg-gray-50" required readonly>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">–û–ø–ª–∞—á–µ–Ω —á–µ—Ä–µ–∑</label>
                <select id="bank" class="mt-1 block w-full border rounded px-3 py-2">
                    <option>Mbank</option>
                    <option>o! bank</option>
                    <option>–î—Ä—É–≥–æ–π</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
                <input id="recipient" type="text" value="Aida.M" class="mt-1 block w-full border rounded px-3 py-2" readonly>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">–ß–µ–∫ / –∫–≤–∏—Ç–∞–Ω—Ü–∏—è (—Ñ–æ—Ç–æ –∏–ª–∏ —Ñ–∞–π–ª)</label>
                <input id="receipt" type="file" accept="image/*,.pdf,.doc,.docx" class="mt-1 block w-full" required>
                <p class="text-xs text-gray-500 mt-1">–î–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã (PDF, DOC). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Telegram (–æ–±—ã—á–Ω–æ –¥–æ 50 –ú–ë –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤).</p>
            </div>

            <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–∞ —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞—è–≤–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å pendingOrder -->

            <div class="flex items-center space-x-3">
                <button id="sendBtn" type="submit" class="bg-blue-600 text-white px-4 py-2 rounded font-medium">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫</button>
                <button id="clearBtn" type="button" class="bg-gray-200 text-gray-800 px-4 py-2 rounded">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>

            <div id="status" class="text-sm text-gray-700 mt-2"></div>
        </form>

        <!-- success modal -->
        <div id="success" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center">
                <h3 class="text-lg font-semibold mb-2">–°–ø–∞—Å–∏–±–æ!</h3>
                <p class="text-gray-700 mb-4">–í–∞—à —á–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.</p>
                <button id="closeSuccess" class="bg-blue-600 text-white px-4 py-2 rounded">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

    </div>

    <script>
        // Adjust these to your bot token / chat id (same as used in site)
        const BOT_TOKEN = '8308940359:AAFYtTfVx6BIOUyZoMUkrXh9ZdUvjoRrz6M';
        const CHAT_ID = '6533332698';

    const form = document.getElementById('paymentForm');
        const statusEl = document.getElementById('status');
        const successModal = document.getElementById('success');
        const closeSuccess = document.getElementById('closeSuccess');
        const orderSummaryEl = document.getElementById('orderSummary');
    const sendBtn = document.getElementById('sendBtn');

    // Amount field is now readonly and will be set from pendingOrder

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞ ‚Äî –ø–æ–∫–∞–∂–µ–º –µ—ë –∏ –ø–æ–¥—Å—Ç–∞–≤–∏–º –ø–æ–ª—è
        let pendingOrder = null;
    try {
            const raw = localStorage.getItem('pendingOrder');
            if (raw) {
                pendingOrder = JSON.parse(raw);
                orderSummaryEl.classList.remove('hidden');
                orderSummaryEl.innerHTML = `
                    <strong class="block mb-2">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞ ‚Äî –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–ª–∞—Ç—É</strong>
                    <div class="text-sm text-gray-700">
                        <div><strong>–ò–º—è:</strong> ${pendingOrder.name || '‚Äî'}</div>
                        <div><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${pendingOrder.phone || '‚Äî'}</div>
                        <div><strong>–¢–æ–≤–∞—Ä/—É—Å–ª—É–≥–∞:</strong> ${pendingOrder.product || '‚Äî'}</div>
                        <div><strong>–¶–µ–Ω–∞:</strong> ${pendingOrder.price || '‚Äî'}</div>
                        <div><strong>–¢–∞—Ä–∏—Ñ:</strong> ${pendingOrder.tariff || '‚Äî'}</div>
                    </div>
                    <div class="mt-3">
                        <button id="clearPending" type="button" class="text-sm text-red-600 underline">–û—Ç–º–µ–Ω–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∑–∞—è–≤–∫—É</button>
                    </div>
                `;

                // –ü–æ–¥—Å—Ç–∞–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã
                if (pendingOrder.name) document.getElementById('payerName').value = pendingOrder.name;
                // –ù–æ–º–µ—Ä –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ –±–µ—Ä—ë–º –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ (–ø–æ–ª–µ –Ω–∞ —Ñ–æ—Ä–º–µ —É–±—Ä–∞–Ω–æ)
                if (pendingOrder.price && !document.getElementById('amount').value) document.getElementById('amount').value = pendingOrder.price;

                // –ü–æ–∫–∞–∑–∞—Ç—å –±–ª–æ–∫ —Å —Ü–µ–Ω–æ–π —Ç–∞—Ä–∏—Ñ–∞
                const orderTotalsEl = document.getElementById('orderTotals');
                const tariffPriceEl = document.getElementById('tariffPrice');
                function updateTotals() {
                    if (orderTotalsEl && tariffPriceEl && pendingOrder && pendingOrder.price) {
                        tariffPriceEl.textContent = '–¶–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞: ' + pendingOrder.price + ' —Å–æ–º';
                        orderTotalsEl.classList.remove('hidden');
                    }
                }
                // –í—ã–ø–æ–ª–Ω–∏–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                updateTotals();

                // Amount is now readonly and always matches the pendingOrder price
            }
        } catch (err) {
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∑–∞—è–≤–∫—É:', err);
        }

        // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏
        document.addEventListener('click', function (ev) {
            if (ev.target && ev.target.id === 'clearPending') {
                localStorage.removeItem('pendingOrder');
                orderSummaryEl.classList.add('hidden');
                pendingOrder = null;
            }
        });

        function setStatus(text, isError) {
            statusEl.textContent = text;
            statusEl.style.color = isError ? 'crimson' : '#0f172a';
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const name = document.getElementById('payerName').value.trim();
            // –ù–æ–º–µ—Ä –ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∞ –±–µ—Ä—ë–º –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ (pendingOrder), –µ—Å–ª–∏ –µ—Å—Ç—å
            const phone = (pendingOrder && pendingOrder.phone) ? pendingOrder.phone : '';
            const amount = document.getElementById('amount').value.trim();
            const bank = document.getElementById('bank').value;
            const recipient = document.getElementById('recipient').value;
            const receiptInput = document.getElementById('receipt');

            if (!receiptInput.files || receiptInput.files.length === 0) {
                setStatus('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —á–µ–∫/–∫–≤–∏—Ç–∞–Ω—Ü–∏—é.', true);
                return;
            }

            const file = receiptInput.files[0];

            setStatus('–û—Ç–ø—Ä–∞–≤–∫–∞...');
            document.getElementById('sendBtn').disabled = true;

            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞ ‚Äî –≤–∫–ª—é—á–∏–º –µ—ë –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ
            let orderInfo = '';
            if (pendingOrder) {
                orderInfo = `\n\nüìù –°–≤–µ–¥–µ–Ω–∏—è –æ –∑–∞—è–≤–∫–µ:\nüë§ –ò–º—è: ${pendingOrder.name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${pendingOrder.phone}\nüì¶ –¢–æ–≤–∞—Ä/—É—Å–ª—É–≥–∞: ${pendingOrder.product}\nüí∞ –¶–µ–Ω–∞ (–∑–∞—è–≤–∫–∞): ${pendingOrder.price} —Å–æ–º\nüìä –¢–∞—Ä–∏—Ñ: ${pendingOrder.tariff}`;
            }

            const message = `üì• –ù–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞/—á–µ–∫ —Å —Å–∞–π—Ç–∞\n\nüë§ –ü–ª–∞—Ç–µ–ª—å—â–∏–∫: ${name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\nüí∞ –°—É–º–º–∞: ${amount} —Å–æ–º\nüè¶ –ë–∞–Ω–∫: ${bank}\nüë©‚Äçüíº –ü–æ–ª—É—á–∞—Ç–µ–ª—å: ${recipient}${orderInfo}`;

            try {
                // send text message first
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: CHAT_ID, text: message })
                });

                // —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–∏–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–∞, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤ pendingOrder (–µ—Å–ª–∏ –µ—Å—Ç—å)
                    if (pendingOrder && Array.isArray(pendingOrder.photos) && pendingOrder.photos.length > 0) {
                        // helper: convert dataURL to blob
                        function dataURLtoBlob(dataurl) {
                            const arr = dataurl.split(',');
                            const mime = arr[0].match(/:(.*?);/)[1];
                            const bstr = atob(arr[1]);
                            let n = bstr.length;
                            const u8arr = new Uint8Array(n);
                            while (n--) {
                                u8arr[n] = bstr.charCodeAt(n);
                            }
                            return new Blob([u8arr], { type: mime });
                        }

                        for (let i = 0; i < pendingOrder.photos.length; i++) {
                            const p = pendingOrder.photos[i];
                            try {
                                const blob = dataURLtoBlob(p.data);
                                const pForm = new FormData();
                                pForm.append('chat_id', CHAT_ID);
                                pForm.append('photo', blob, p.name || `photo_${i}.jpg`);
                                pForm.append('caption', i === 0 ? `üì∏ –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ –∫ –∑–∞—è–≤–∫–µ${pendingOrder ? ' –æ—Ç ' + (pendingOrder.name || '') : ''}` : '');
                                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: 'POST', body: pForm });
                            } catch (err) {
                                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –∏–∑ pendingOrder:', err);
                            }
                        }
                    }

                // –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–∏–º —á–µ–∫/–∫–≤–∏—Ç–∞–Ω—Ü–∏—é (–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç)
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                const mime = file.type || '';
                const isImage = mime.startsWith('image/');
                if (isImage) {
                    formData.append('photo', file, file.name);
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method: 'POST', body: formData });
                } else {
                    formData.append('document', file, file.name);
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`, { method: 'POST', body: formData });
                }

                setStatus('–ß–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ.');
                successModal.classList.remove('hidden');
                form.reset();
                // –ï—Å–ª–∏ –±—ã–ª–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞ ‚Äî –æ—á–∏—Å—Ç–∏–º –µ—ë
                if (pendingOrder) {
                    localStorage.removeItem('pendingOrder');
                    pendingOrder = null;
                    orderSummaryEl.classList.add('hidden');
                }
            } catch (err) {
                console.error(err);
                setStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é.', true);
            } finally {
                document.getElementById('sendBtn').disabled = false;
            }
        });

        closeSuccess.addEventListener('click', () => {
            successModal.classList.add('hidden');
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            form.reset();
            setStatus('');
        });
    </script>
</body>
</html>
